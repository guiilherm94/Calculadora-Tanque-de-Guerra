<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Tanque de Guerra - Plano de Quitação</title>
    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- Ícones -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        :root {
            --bg-dark: #0f172a;
            --panel-dark: #1e293b;
            --accent: #f97316; /* Laranja Tático */
            --danger: #ef4444;
            --success: #22c55e;
            --text-light: #f1f5f9;
            --text-muted: #94a3b8;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* --- Header --- */
        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--panel-dark);
            padding-bottom: 20px;
        }

        h1 {
            font-family: 'Black Ops One', cursive;
            font-size: 3rem;
            color: var(--text-light);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h1 span { color: var(--accent); }

        p.subtitle {
            color: var(--text-muted);
            margin-top: 10px;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.1rem;
            letter-spacing: -0.5px;
        }

        /* --- Cards e Inputs --- */
        .card {
            background-color: var(--panel-dark);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #334155;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            background-color: var(--bg-dark);
            border: 1px solid #475569;
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            border-color: var(--accent);
        }

        button.btn-add {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.1s, background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button.btn-add:hover { background-color: #ea580c; transform: translateY(-2px); }

        /* --- Lista de Dívidas --- */
        .debt-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .debt-item {
            background-color: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .debt-item.giant { border-left-color: var(--danger); background-color: rgba(239, 68, 68, 0.1); }
        .debt-item.small { border-left-color: var(--success); background-color: rgba(34, 197, 94, 0.1); }

        .debt-info h4 { margin: 0 0 5px 0; font-size: 1rem; }
        .debt-details { font-size: 0.85rem; color: var(--text-muted); font-family: 'Roboto Mono', monospace; }

        .btn-remove {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 5px;
        }
        .btn-remove:hover { color: var(--danger); }

        /* --- Botão Gerar --- */
        .btn-generate {
            background-color: var(--success);
            color: white;
            border: none;
            padding: 20px;
            width: 100%;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            letter-spacing: 1px;
            box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.3);
            transition: all 0.2s;
        }
        .btn-generate:hover { transform: scale(1.02); background-color: #16a34a; }

        /* --- Resultados (Timeline) --- */
        #results-area {
            display: none; /* Escondido até gerar */
            margin-top: 40px;
            animation: slideUp 0.5s ease-out;
        }

        .timeline-item {
            position: relative;
            padding-left: 40px;
            margin-bottom: 30px;
            border-left: 2px solid #334155;
        }

        .timeline-marker {
            position: absolute;
            left: -16px;
            top: 0;
            width: 30px;
            height: 30px;
            background-color: var(--panel-dark);
            border: 2px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--accent);
        }

        .timeline-content {
            background-color: var(--panel-dark);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #334155;
        }

        .action-text {
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .highlight-green { color: var(--success); font-weight: bold; }
        .highlight-orange { color: var(--accent); font-weight: bold; }
        .highlight-blue { color: #3b82f6; font-style: italic; }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        .stat-box { flex: 1; text-align: center; }
        .stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; }
        .stat-value { font-size: 1.2rem; font-weight: bold; color: white; }

        /* Print Button */
        .print-only { display: none; }
        .no-print { display: block; }

        @media print {
            body { background-color: white; color: black; }
            .container { max-width: 100%; box-shadow: none; }
            .card, .timeline-content { border: 1px solid #ccc; background-color: white; color: black; box-shadow: none; }
            input, select { border: 1px solid #ccc; color: black; }
            h1, h2, h3, p, span { color: black !important; }
            .btn-add, .btn-remove, .btn-generate, .input-section { display: none !important; }
            #results-area { display: block !important; }
            .debt-item { border: 1px solid #ccc; color: black; }
            .print-only { display: block; text-align: center; margin-bottom: 20px; }
            .timeline-item { border-left: 2px solid #000; }
            .timeline-marker { border: 2px solid #000; color: #000; background: #fff; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 600px) {
            .form-grid { grid-template-columns: 1fr; }
            h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Calculadora <span>Tanque de Guerra</span></h1>
            <p class="subtitle">O plano de combate para a quitação acelerada de dívidas e blindagem do seu patrimônio.</p>
        </header>

        <!-- INPUT SECTION -->
        <div class="input-section">

            <!-- 1. Renda Extra -->
            <div class="card">
                <div class="section-title"><i class="ph-fill ph-coins"></i> 1. Munição Extra</div>
                <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px;">
                    Quanto dinheiro você consegue juntar por mês cortando gastos ou fazendo renda extra? (Não conte o dinheiro das dívidas que vai parar de pagar ainda).
                </p>
                <div class="input-group">
                    <label>Valor Mensal (R$)</label>
                    <input type="number" id="extraIncome" placeholder="Ex: 300.00" min="0" step="0.01">
                </div>
            </div>

            <!-- 2. Dívidas -->
            <div class="card">
                <div class="section-title"><i class="ph-fill ph-skull"></i> 2. Mapear Inimigos</div>

                <div class="form-grid">
                    <div class="input-group">
                        <label>Nome da Dívida</label>
                        <input type="text" id="debtName" placeholder="Ex: Cartão Nubank">
                    </div>
                    <div class="input-group">
                        <label>Valor Total para Quitar Hoje (R$)</label>
                        <input type="number" id="debtValue" placeholder="Ex: 2000.00" min="0" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Parcela/Mínimo Mensal Atual (R$)</label>
                        <input type="number" id="debtPayment" placeholder="Ex: 150.00" min="0" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Estratégia</label>
                        <select id="debtStrategy">
                            <option value="small">ATACAR (Dívida Pequena)</option>
                            <option value="giant">CONGELAR (Dívida Gigante/Abusiva)</option>
                        </select>
                    </div>
                </div>
                <button class="btn-add" onclick="addDebt()">
                    <i class="ph-bold ph-plus"></i> Adicionar Dívida
                </button>

                <div style="margin-top: 20px;">
                    <ul id="debtList" class="debt-list">
                        <!-- Lista JS aqui -->
                    </ul>
                </div>
            </div>

            <button class="btn-generate" onclick="calculateWarPlan()">
                Gerar Plano de Combate
            </button>
        </div>

        <!-- RESULTS SECTION -->
        <div id="results-area">
            <div class="print-only">
                <h2>PLANO DE COMBATE FINANCEIRO</h2>
            </div>

            <div class="stats-bar">
                <div class="stat-box">
                    <div class="stat-label">Munição Mensal</div>
                    <div class="stat-value" id="statAmmo">R$ 0,00</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Tempo Estimado</div>
                    <div class="stat-value" id="statTime">0 Meses</div>
                </div>
            </div>

            <h3 style="color: var(--text-light); margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 10px;">CRONOGRAMA DE AÇÃO</h3>
            <div id="timelineContainer">
                <!-- Timeline JS aqui -->
            </div>

            <div class="no-print" style="margin-top: 30px; text-align: center;">
                <button onclick="window.print()" style="background: var(--panel-dark); color: white; border: 2px solid var(--text-muted); padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                    <i class="ph-bold ph-printer"></i> Imprimir / Salvar PDF
                </button>
            </div>
        </div>

    </div>

    <script>
        let debts = [];

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function addDebt() {
            const name = document.getElementById('debtName').value;
            const value = parseFloat(document.getElementById('debtValue').value);
            const payment = parseFloat(document.getElementById('debtPayment').value);
            const type = document.getElementById('debtStrategy').value;

            if (!name || isNaN(value) || isNaN(payment)) {
                alert("Preencha todos os campos corretamente!");
                return;
            }

            const debt = {
                id: Date.now(),
                name,
                value,
                payment,
                type // 'small' or 'giant'
            };

            debts.push(debt);
            renderDebtList();

            // Limpar campos
            document.getElementById('debtName').value = '';
            document.getElementById('debtValue').value = '';
            document.getElementById('debtPayment').value = '';
            document.getElementById('debtName').focus();
        }

        function removeDebt(id) {
            debts = debts.filter(d => d.id !== id);
            renderDebtList();
        }

        function renderDebtList() {
            const list = document.getElementById('debtList');
            list.innerHTML = '';

            debts.forEach(d => {
                const li = document.createElement('li');
                li.className = `debt-item ${d.type}`;
                li.innerHTML = `
                    <div class="debt-info">
                        <h4>${d.name} ${d.type === 'giant' ? '(CONGELAR)' : '(ATACAR)'}</h4>
                        <div class="debt-details">
                            Total: ${formatCurrency(d.value)} | Mensal: ${formatCurrency(d.payment)}
                        </div>
                    </div>
                    <button class="btn-remove" onclick="removeDebt(${d.id})"><i class="ph-bold ph-trash"></i></button>
                `;
                list.appendChild(li);
            });
        }

        function calculateWarPlan() {
            const extraIncome = parseFloat(document.getElementById('extraIncome').value) || 0;

            if (debts.length === 0) {
                alert("Adicione pelo menos uma dívida!");
                return;
            }

            // 1. Calcular Munição Total (Renda Extra + Parcelas das Gigantes Congeladas)
            let ammoFromGiants = debts.filter(d => d.type === 'giant').reduce((sum, d) => sum + d.payment, 0);
            let totalMonthlyAmmo = extraIncome + ammoFromGiants;

            if (totalMonthlyAmmo <= 0) {
                alert("Atenção: Você precisa de alguma munição (Renda Extra ou dinheiro liberado das gigantes) para começar!");
                return;
            }

            // 2. Preparar Listas
            // Ordenar pequenas pelo valor total (Menor para Maior)
            let activeSmallDebts = debts.filter(d => d.type === 'small').sort((a, b) => a.value - b.value);

            // Gigantes com alvo de acordo (20% do valor original)
            let activeGiantDebts = debts.filter(d => d.type === 'giant')
                .map(d => ({ ...d, settlementTarget: d.value * 0.20 }))
                .sort((a, b) => a.value - b.value); // Ordena gigantes também para ter um critério

            let timeline = [];
            let currentMonth = 0;
            let warChest = 0;
            let isFree = false;

            // Simulação
            while (!isFree && currentMonth < 120) { // Limite 10 anos
                currentMonth++;
                let monthlyLog = {
                    month: currentMonth,
                    actions: [],
                    warChestEnd: 0
                };

                let moneyAvailable = totalMonthlyAmmo;

                // --- FASE 1: PAGAMENTO MÍNIMO DAS PEQUENAS ---
                // Se uma dívida pequena está ativa, precisamos pagar a parcela dela?
                // Na estratégia de guerra, assumimos que usamos TUDO para matar a primeira.
                // Mas, tecnicamente, se não pagarmos a parcela das outras pequenas, elas viram gigantes.
                // Lógica: Subtrair as parcelas das outras pequenas ativas da munição disponível.

                let mandatoryPayments = 0;

                // Exclui a dívida alvo (a primeira da fila) da conta de "pagar mínimo", pois vamos pagar O MÁXIMO nela.
                // As outras pequenas recebem o pagamento normal para não virarem bola de neve negativa.
                for (let i = 1; i < activeSmallDebts.length; i++) {
                    mandatoryPayments += activeSmallDebts[i].payment;
                }

                moneyAvailable -= mandatoryPayments;

                // --- FASE 2: ATAQUE NA PEQUENA Nº 1 ---
                if (activeSmallDebts.length > 0) {
                    let target = activeSmallDebts[0];

                    // O dinheiro disponível para a alvo é o que sobrou + a parcela dela mesma (que já estava no orçamento original)
                    // Mas espera, "moneyAvailable" veio de (RendaExtra + GiantPayments).
                    // As parcelas das Small Debts NÃO estavam em "totalMonthlyAmmo".
                    // Vamos ajustar a lógica para ser contabilmente correta para o usuário.

                    /* Lógica Simplificada para o Usuário:
                       Ele tem um "Poder de Fogo" (Dinheiro livre).
                       Ele usa esse poder para ABATER a dívida alvo ALÉM da parcela mínima dela?
                       Ou a calculadora assume que ele só tem esse dinheiro?

                       Vamos assumir que o usuário parou de pagar as gigantes.
                       Ele continua pagando as pequenas normalmente.
                       O "totalMonthlyAmmo" é o EXTRA que ele vai injetar para ACELERAR.
                    */

                   // REVISÃO DA LÓGICA DE MUNIÇÃO:
                   // Munição = Renda Extra + Parcelas das Gigantes.
                   // As parcelas das pequenas continuam sendo pagas "por fora" do cálculo de munição,
                   // EXCETO quando quitamos uma. Aí a parcela dela entra na munição (Bola de Neve).

                   // Vamos usar uma variável 'snowballEffect' que começa em 0 e cresce conforme quitamos pequenas.
                }
            }

            // RE-STARTING CALCULATION WITH CLEANER LOGIC
            let snowballAmmo = 0; // Dinheiro liberado de pequenas quitadas
            let baseAmmo = totalMonthlyAmmo; // Renda Extra + Gigantes

            // Reset Arrays
            activeSmallDebts = debts.filter(d => d.type === 'small').sort((a, b) => a.value - b.value);
            activeGiantDebts = debts.filter(d => d.type === 'giant').map(d => ({ ...d, settlementTarget: d.value * 0.20 })).sort((a, b) => a.value - b.value);

            timeline = [];
            currentMonth = 0;
            warChest = 0;
            isFree = false;

            while (!isFree && currentMonth < 120) {
                currentMonth++;
                let monthlyLog = { month: currentMonth, actions: [], warChestEnd: 0 };

                // Dinheiro disponível para ABATER principal = BaseAmmo + SnowballAmmo
                let attackMoney = baseAmmo + snowballAmmo;

                // 1. Atacar Pequenas
                if (activeSmallDebts.length > 0) {
                    let target = activeSmallDebts[0];

                    if (attackMoney >= target.value) {
                        // Quitou!
                        attackMoney -= target.value;
                        monthlyLog.actions.push({ text: `QUITOU: ${target.name}`, type: 'success' });

                        // O valor da parcela dessa dívida agora vira munição para sempre
                        snowballAmmo += target.payment;

                        activeSmallDebts.shift(); // Remove da lista

                        // Se sobrou dinheiro, ataca a próxima
                        while (activeSmallDebts.length > 0 && attackMoney >= activeSmallDebts[0].value) {
                            let next = activeSmallDebts[0];
                            attackMoney -= next.value;
                            monthlyLog.actions.push({ text: `QUITOU TAMBÉM: ${next.name}`, type: 'success' });
                            snowballAmmo += next.payment;
                            activeSmallDebts.shift();
                        }
                    } else {
                        // Abate parcial
                        target.value -= attackMoney;
                        monthlyLog.actions.push({ text: `Abateu R$ ${formatCurrency(attackMoney)} em ${target.name} (Falta: ${formatCurrency(target.value)})`, type: 'progress' });
                        attackMoney = 0;
                    }
                }

                // 2. Acumular Caixa (Se não tem pequenas ou sobrou dinheiro)
                if (attackMoney > 0) {
                    warChest += attackMoney;
                    monthlyLog.actions.push({ text: `Guardou R$ ${formatCurrency(attackMoney)} no Caixa de Guerra`, type: 'info' });
                }

                // 3. Checar Gigantes (Acordo)
                if (activeSmallDebts.length === 0 && activeGiantDebts.length > 0) {
                    let giant = activeGiantDebts[0];
                    if (warChest >= giant.settlementTarget) {
                        warChest -= giant.settlementTarget;
                        monthlyLog.actions.push({ text: `GRANDE VITÓRIA! Fez acordo e quitou ${giant.name} por ${formatCurrency(giant.settlementTarget)}`, type: 'victory' });
                        activeGiantDebts.shift();
                    } else {
                        monthlyLog.actions.push({ text: `Aguardando caixa para ${giant.name} (Alvo: ${formatCurrency(giant.settlementTarget)})`, type: 'wait' });
                    }
                }

                monthlyLog.warChestEnd = warChest;
                if (monthlyLog.actions.length > 0) timeline.push(monthlyLog);

                if (activeSmallDebts.length === 0 && activeGiantDebts.length === 0) isFree = true;
            }

            renderTimeline(timeline, totalMonthlyAmmo);
        }

        function renderTimeline(timeline, startAmmo) {
            const container = document.getElementById('timelineContainer');
            container.innerHTML = '';

            document.getElementById('statAmmo').innerText = formatCurrency(startAmmo);
            document.getElementById('statTime').innerText = timeline.length + (timeline.length >= 120 ? "+" : "") + " Meses";

            timeline.forEach(log => {
                const item = document.createElement('div');
                item.className = 'timeline-item';

                let actionsHtml = log.actions.map(act => {
                    let icon = '';
                    let colorClass = '';

                    if (act.type === 'success') { icon = '<i class="ph-fill ph-check-circle"></i>'; colorClass = 'highlight-green'; }
                    else if (act.type === 'progress') { icon = '<i class="ph-bold ph-trend-down"></i>'; colorClass = ''; }
                    else if (act.type === 'victory') { icon = '<i class="ph-fill ph-trophy"></i>'; colorClass = 'highlight-orange'; }
                    else if (act.type === 'info') { icon = '<i class="ph-bold ph-piggy-bank"></i>'; colorClass = 'highlight-blue'; }
                    else { icon = '<i class="ph-bold ph-clock"></i>'; }

                    return `<div class="action-text ${colorClass}">${icon} ${act.text}</div>`;
                }).join('');

                item.innerHTML = `
                    <div class="timeline-marker">${log.month}</div>
                    <div class="timeline-content">
                        ${actionsHtml}
                        <div style="margin-top:10px; font-size:0.8rem; color:#64748b; border-top:1px solid #334155; padding-top:5px;">
                            Caixa de Guerra Acumulado: ${formatCurrency(log.warChestEnd)}
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });

            document.getElementById('results-area').style.display = 'block';
            document.getElementById('results-area').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
